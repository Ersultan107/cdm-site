<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≠–ö | –ü–û–†–¢–ê–õ –ö–î–ú</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        /* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∞ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–∞ –Ω–æ—É—Ç–µ */
        html { font-size: 18px; }
        @media (min-width: 1024px) { html { font-size: 20px; } }

        body { font-family: 'Inter', sans-serif; transition: 0.3s; }
        .tab-content { display: none; animation: fadeInUp 0.5s ease forwards; }
        .tab-content.active { display: block; }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .poll-bar {
            position: absolute; left: 0; top: 0; bottom: 0;
            background: rgba(37, 99, 235, 0.2);
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 0;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass-nav { backdrop-filter: blur(15px); background: rgba(30, 64, 175, 0.9); }
        .dark .glass-nav { background: rgba(15, 23, 42, 0.95); }

        .comment-card { animation: slideIn 0.4s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="bg-slate-50 dark:bg-[#0b1120] text-slate-900 dark:text-slate-100">

    <audio id="login-sound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>

    <div id="auth-screen" class="fixed inset-0 z-[100] bg-[#020617] flex items-center justify-center p-6 transition-all duration-700">
        <div class="w-full max-w-md text-center">
            <div class="mb-10 inline-block p-8 bg-blue-600 rounded-[40px] shadow-2xl">
                <i class="fas fa-university text-6xl text-white"></i>
            </div>
            <h2 class="text-white text-4xl font-black mb-10 tracking-widest italic uppercase">–ê–≠–ö –ü–û–†–¢–ê–õ</h2>
            <div class="space-y-4">
                <input type="text" id="user-name" placeholder="–ò–º—è –∏ –§–∞–º–∏–ª–∏—è" class="w-full p-6 rounded-[30px] bg-white/5 border-2 border-white/10 text-white outline-none focus:border-blue-500 text-center font-bold text-xl">
                <input type="text" id="user-group" placeholder="–¢–≤–æ—è –ì—Ä—É–ø–ø–∞ (–Ω–∞–ø—Ä. –ò–° 2-1)" class="w-full p-6 rounded-[30px] bg-white/5 border-2 border-white/10 text-white outline-none focus:border-blue-500 text-center font-bold uppercase tracking-widest text-xl">
            </div>
            <button onclick="handleLogin()" class="w-full mt-10 bg-blue-600 text-white py-6 rounded-[30px] font-black text-2xl hover:scale-105 active:scale-95 transition-all shadow-2xl">–í–û–ô–¢–ò –í –°–ò–°–¢–ï–ú–£</button>
        </div>
    </div>

    <div id="main-app" class="hidden min-h-screen">
        <header class="fixed top-0 left-0 right-0 z-50 glass-nav text-white px-8 py-5 border-b border-white/10">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 bg-white text-blue-700 rounded-2xl flex items-center justify-center font-black text-2xl shadow-xl">–ê</div>
                    <div>
                        <p id="display-name" class="font-black text-xl leading-none">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                        <p id="display-group" class="text-xs opacity-60 font-black uppercase tracking-widest mt-1">–ì—Ä—É–ø–ø–∞</p>
                    </div>
                </div>
                <button onclick="toggleDark()" class="w-14 h-14 rounded-2xl bg-white/10 hover:bg-white/20 transition flex items-center justify-center text-2xl">
                    <i id="theme-icon" class="fas fa-moon"></i>
                </button>
            </div>
        </header>

        <main class="pt-36 pb-20 px-8 max-w-7xl mx-auto">
            <div class="flex overflow-x-auto gap-4 mb-12 pb-4 no-scrollbar">
                <button onclick="switchTab('voice')" class="px-10 py-5 rounded-[25px] bg-blue-600 text-white shadow-xl font-black text-sm flex-shrink-0 transition-all active:scale-95">üó≥Ô∏è –ì–û–õ–û–°–û–í–ê–ù–ò–ï / –ß–ê–¢</button>
                <button onclick="switchTab('home')" class="px-10 py-5 rounded-[25px] bg-white dark:bg-slate-800 shadow-lg font-black text-sm flex-shrink-0 dark:border-slate-700 transition-all active:scale-95">üè¢ –û –ö–û–õ–õ–ï–î–ñ–ï</button>
                <button onclick="switchTab('rating')" class="px-10 py-5 rounded-[25px] bg-white dark:bg-slate-800 shadow-lg font-black text-sm flex-shrink-0 dark:border-slate-700 transition-all active:scale-95">üèÜ –¢–û–ü –ê–ö–¢–ò–í–ò–°–¢–û–í</button>
                <button onclick="switchTab('team')" class="px-10 py-5 rounded-[25px] bg-white dark:bg-slate-800 shadow-lg font-black text-sm flex-shrink-0 dark:border-slate-700 transition-all active:scale-95">üë• –ö–û–ú–ê–ù–î–ê –ö–î–ú</button>
            </div>

            <section id="tab-voice" class="tab-content active grid lg:grid-cols-2 gap-10">
                <div class="bg-white dark:bg-slate-800 p-10 rounded-[50px] shadow-2xl border border-slate-100 dark:border-slate-700">
                    <div class="flex items-center gap-3 mb-8">
                        <span class="bg-red-500 text-white text-xs font-black px-3 py-1 rounded-full animate-pulse">–ê–ö–¢–ò–í–ù–û</span>
                        <h3 class="font-black text-3xl uppercase italic">–ú–Ω–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h3>
                    </div>
                    <h4 id="poll-question" class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-10 leading-tight italic">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–ø—Ä–æ—Å–∞...</h4>
                    <div id="poll-options" class="space-y-4">
                        </div>
                </div>

                <div class="bg-white dark:bg-slate-800 p-10 rounded-[50px] shadow-2xl border border-slate-100 dark:border-slate-700 flex flex-col h-[650px]">
                    <h3 class="font-black text-3xl mb-8 uppercase italic"><i class="fas fa-comment-dots mr-3 text-blue-500"></i> –ü—Ä—è–º–æ–π —ç—Ñ–∏—Ä</h3>
                    <div id="comments-list" class="flex-1 overflow-y-auto pr-4 mb-6 space-y-4 no-scrollbar">
                        <p class="text-center opacity-20 italic">–°—Ç–µ–Ω–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>
                    </div>
                    <div class="relative">
                        <input type="text" id="comment-input" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..." class="w-full p-6 rounded-[30px] bg-slate-100 dark:bg-slate-900 border-none outline-none focus:ring-4 ring-blue-500/30 text-lg font-medium pr-20">
                        <button onclick="sendComment()" class="absolute right-3 top-3 bottom-3 bg-blue-600 text-white w-14 rounded-full hover:bg-blue-700 transition-all flex items-center justify-center">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </section>

            <section id="tab-home" class="tab-content">
                <div class="bg-blue-700 p-12 rounded-[60px] text-white shadow-2xl mb-10 relative overflow-hidden">
                    <h2 class="text-5xl font-black mb-6 italic uppercase z-10 relative">–ê–≠–ö: –ö—É–∑–Ω–∏—Ü–∞ –∫–∞–¥—Ä–æ–≤</h2>
                    <p class="text-xl opacity-90 leading-relaxed max-w-3xl z-10 relative">–ê–ª–º–∞—Ç–∏–Ω—Å–∫–∏–π –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –ö–æ–ª–ª–µ–¥–∂ ‚Äî —ç—Ç–æ —Ñ–ª–∞–≥–º–∞–Ω –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ –ê–ª–º–∞—Ç—ã. –ú—ã –≤–µ—Ä–∏–º –≤ —Å–∏–ª—É –º–æ–ª–æ–¥–µ–∂–∏ –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞. –ö–î–ú (–ö–æ–º–∏—Ç–µ—Ç –ø–æ –¥–µ–ª–∞–º –º–æ–ª–æ–¥–µ–∂–∏) ‚Äî —Ç–≤–æ–π –ø—É—Ç—å –∫ –ª–∏–¥–µ—Ä—Å—Ç–≤—É.</p>
                    <i class="fas fa-graduation-cap absolute -right-10 -bottom-10 text-[15rem] opacity-10"></i>
                </div>
            </section>

            <section id="tab-rating" class="tab-content">
                <div class="bg-white dark:bg-slate-800 p-12 rounded-[60px] shadow-2xl max-w-3xl mx-auto" id="leaderboard"></div>
            </section>

            <section id="tab-team" class="tab-content">
                <div id="team-list" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            </section>
        </main>
    </div>

    <script>
        const SHEET_ID = '1BEi1MzL4-2vTVGa_2yyYnVkkDcSch6GIZKeWUHRYFxY';
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbywhEqawg1SWOhr6rFFOPaEMDCZn2ZtMyjY4qYyF3VVdepwVd1zGwoy4cNFShbZfxTj/exec';
        const GIDS = { team: '0', polls: '1044546960', comments: '194206114' };

        // –í–•–û–î –í –ü–†–ò–õ–û–ñ–ï–ù–ò–ï
        function handleLogin() {
            const u = document.getElementById('user-name').value;
            const g = document.getElementById('user-group').value.toUpperCase();
            if(u.length > 2) {
                document.getElementById('login-sound').play();
                localStorage.setItem('aec_u', u); localStorage.setItem('aec_g', g);
                document.getElementById('auth-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('auth-screen').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');
                    document.getElementById('display-name').innerText = u;
                    document.getElementById('display-group').innerText = g;
                    initApp();
                }, 600);
            }
        }

        function initApp() {
            loadPolls(); loadComments(); loadData();
            setInterval(loadComments, 5000); // –ß–∞—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ —Å–∞–º
            setInterval(loadPolls, 10000); // –ü—Ä–æ—Ü–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        }

        // –ó–ê–ì–†–£–ó–ö–ê –ì–û–õ–û–°–û–í–ê–ù–ò–Ø
        async function loadPolls() {
            const res = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GIDS.polls}&t=${Date.now()}`);
            const text = await res.text(); const json = JSON.parse(text.substring(47).slice(0, -2));
            const poll = json.table.rows.find(r => r.c[3]?.v === 'active');
            
            if(poll) {
                const v1 = poll.c[4]?.v || 0; const v2 = poll.c[5]?.v || 0;
                const total = v1 + v2 || 1;
                const p1 = Math.round((v1/total)*100); const p2 = 100 - p1;

                document.getElementById('poll-question').innerText = poll.c[0].v;
                document.getElementById('poll-options').innerHTML = `
                    <button onclick="submitVote(1)" class="w-full p-8 rounded-[35px] border-4 border-slate-100 dark:border-slate-700 text-left font-black text-xl relative overflow-hidden group hover:border-blue-500 transition-all">
                        <div class="poll-bar" style="width:${p1}%"></div>
                        <span class="relative z-10 flex justify-between uppercase tracking-tight">${poll.c[1].v} <span>${p1}%</span></span>
                    </button>
                    <button onclick="submitVote(2)" class="w-full p-8 rounded-[35px] border-4 border-slate-100 dark:border-slate-700 text-left font-black text-xl relative overflow-hidden group hover:border-blue-500 transition-all">
                        <div class="poll-bar" style="width:${p2}%"></div>
                        <span class="relative z-10 flex justify-between uppercase tracking-tight">${poll.c[2].v} <span>${p2}%</span></span>
                    </button>
                    <p class="text-center opacity-30 text-xs font-bold uppercase mt-4 italic">–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤: ${v1 + v2}</p>
                `;
            }
        }

        async function submitVote(opt) {
            // –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è
            const btns = document.querySelectorAll('#poll-options button');
            btns.forEach(b => b.style.opacity = '0.5');
            
            await fetch(SCRIPT_URL, { 
                method: 'POST', 
                mode: 'no-cors',
                body: JSON.stringify({ type: "vote", option: opt }) 
            });
            setTimeout(loadPolls, 500);
        }

        // –ñ–ò–í–û–ô –ß–ê–¢ (–ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò)
        async function loadComments() {
            const res = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GIDS.comments}&t=${Date.now()}`);
            const text = await res.text(); const json = JSON.parse(text.substring(47).slice(0, -2));
            const html = json.table.rows.slice(1).reverse().map(r => `
                <div class="comment-card bg-slate-50 dark:bg-slate-900/60 p-6 rounded-[35px] border border-slate-100 dark:border-slate-800 shadow-sm">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-black text-sm text-blue-600 uppercase tracking-tighter">${r.c[1]?.v || '–°—Ç—É–¥–µ–Ω—Ç'}</span>
                        <span class="text-[10px] font-bold opacity-30">${r.c[2]?.v || ''}</span>
                    </div>
                    <p class="text-lg font-medium leading-relaxed">${r.c[3]?.v || ''}</p>
                </div>`).join('');
            document.getElementById('comments-list').innerHTML = html || '<p class="text-center opacity-20 italic">–ü–æ–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç. –°—Ç–∞–Ω—å –ø–µ—Ä–≤—ã–º!</p>';
        }

        async function sendComment() {
            const input = document.getElementById('comment-input');
            const btn = document.querySelector('[onclick="sendComment()"]');
            if(!input.value.trim()) return;
            
            const msg = input.value;
            input.value = '';
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            const data = { 
                type: "comment", 
                name: localStorage.getItem('aec_u'), 
                group: localStorage.getItem('aec_g'), 
                text: msg 
            };
            
            await fetch(SCRIPT_URL, { 
                method: 'POST', 
                mode: 'no-cors',
                body: JSON.stringify(data) 
            });
            
            btn.innerHTML = '<i class="fas fa-paper-plane"></i>';
            loadComments();
        }

        // –î–ê–ù–ù–´–ï –ö–û–ú–ê–ù–î–´ –ò –†–ï–ô–¢–ò–ù–ì–ê
        async function loadData() {
            const res = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GIDS.team}`);
            const text = await res.text(); const json = JSON.parse(text.substring(47).slice(0, -2));
            const rows = json.table.rows;

            // –ö–æ–º–∞–Ω–¥–∞
            document.getElementById('team-list').innerHTML = rows.slice(1).map(r => r.c[0]?.v ? `
                <div class="bg-white dark:bg-slate-800 p-10 rounded-[50px] shadow-lg hover:shadow-2xl transition-all border border-slate-100 dark:border-slate-700">
                    <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 rounded-3xl flex items-center justify-center font-black text-2xl mb-6 shadow-inner">${r.c[0].v.charAt(0)}</div>
                    <h3 class="font-black text-2xl mb-2">${r.c[0].v}</h3>
                    <p class="text-xs font-black text-blue-500 uppercase mb-6 tracking-widest">${r.c[1]?.v || ''}</p>
                    <p class="opacity-50 text-sm leading-relaxed italic">"${r.c[2]?.v || '–ê–≠–ö ‚Äî —Å–∏–ª–∞ –≤ –µ–¥–∏–Ω—Å—Ç–≤–µ!'}"</p>
                </div>` : '').join('');

            // –†–µ–π—Ç–∏–Ω–≥
            const sorted = rows.slice(1).filter(r => r.c[4]?.v).map(r => ({n: r.c[4].v, s: r.c[5]?.v || 0})).sort((a,b)=>b.s - a.s);
            document.getElementById('leaderboard').innerHTML = `
                <h2 class="text-center font-black text-3xl mb-10 uppercase italic tracking-widest">–¢–æ–ø –ê–∫—Ç–∏–≤–∏—Å—Ç–æ–≤</h2>
                <div class="space-y-4">${sorted.map((p, i) => `
                <div class="flex justify-between items-center p-6 rounded-[35px] ${i==0 ? 'bg-amber-50 dark:bg-amber-900/20 border-2 border-amber-300 shadow-xl scale-105' : 'bg-slate-50 dark:bg-slate-900/40 border border-slate-100 dark:border-slate-800'} transition-all">
                    <div class="flex items-center gap-5">
                        <span class="w-10 h-10 flex items-center justify-center font-black ${i==0?'text-amber-500 text-2xl':'opacity-20 text-xl'}">${i==0?'<i class="fas fa-crown animate-bounce"></i>':i+1}</span>
                        <span class="font-black text-lg">${p.n}</span>
                    </div>
                    <span class="bg-blue-600 text-white px-5 py-2 rounded-2xl font-black text-xs shadow-lg uppercase tracking-widest">${p.s} –ë</span>
                </div>`).join('')}</div>`;
        }

        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function toggleDark() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('theme-icon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('aec_theme', isDark ? 'dark' : 'light');
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-'+id).classList.add('active');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        window.onload = () => {
            if(localStorage.getItem('aec_theme') === 'dark') toggleDark();
            const u = localStorage.getItem('aec_u'); const g = localStorage.getItem('aec_g');
            if(u) {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('display-name').innerText = u;
                document.getElementById('display-group').innerText = g;
                initApp();
            }
        }
    </script>
</body>
</html>
