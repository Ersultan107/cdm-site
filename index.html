<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ê–≠–ö | –ü–û–†–¢–ê–õ –ö–î–ú</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –º–∞—Å—à—Ç–∞–± —Ç–µ–∫—Å—Ç–∞ */
        html { font-size: 15px; } 
        @media (min-width: 768px) { html { font-size: 16px; } }
        @media (min-width: 1024px) { html { font-size: 18px; } }

        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫ */
        .tab-content { display: none; animation: fadeInUp 0.4s ease-out forwards; }
        .tab-content.active { display: block; }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è */
        .poll-bar {
            position: absolute; left: 0; top: 0; bottom: 0;
            background: rgba(37, 99, 235, 0.15);
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 0;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* –°—Ç–∏–ª–∏ —á–∞—Ç–∞ */
        #comments-list::-webkit-scrollbar { width: 4px; }
        #comments-list::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }

        .glass-nav { 
            backdrop-filter: blur(15px); 
            background: rgba(30, 64, 175, 0.9); 
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .dark .glass-nav { background: rgba(15, 23, 42, 0.95); }
    </style>
</head>
<body class="bg-slate-50 dark:bg-[#0b1120] text-slate-900 dark:text-slate-100 transition-colors duration-300">

    <audio id="login-sound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>

    <div id="auth-screen" class="fixed inset-0 z-[100] bg-[#020617] flex items-center justify-center p-6 transition-all duration-700">
        <div class="w-full max-w-md text-center">
            <div class="mb-6 lg:mb-10 inline-block p-6 lg:p-8 bg-blue-600 rounded-[30px] lg:rounded-[40px] shadow-2xl animate-bounce">
                <i class="fas fa-university text-4xl lg:text-6xl text-white"></i>
            </div>
            <h2 class="text-white text-3xl lg:text-4xl font-black mb-8 lg:mb-10 tracking-widest italic uppercase">–ê–≠–ö –ü–û–†–¢–ê–õ</h2>
            <div class="space-y-3 lg:space-y-4">
                <input type="text" id="user-name" placeholder="–ò–º—è –∏ –§–∞–º–∏–ª–∏—è" class="w-full p-4 lg:p-6 rounded-[20px] lg:rounded-[30px] bg-white/5 border-2 border-white/10 text-white outline-none focus:border-blue-500 text-center font-bold text-lg">
                <input type="text" id="user-group" placeholder="–ì—Ä—É–ø–ø–∞ (–Ω–∞–ø—Ä. –ò–° 2-1)" class="w-full p-4 lg:p-6 rounded-[20px] lg:rounded-[30px] bg-white/5 border-2 border-white/10 text-white outline-none focus:border-blue-500 text-center font-bold uppercase tracking-widest text-lg">
            </div>
            <button onclick="handleLogin()" class="w-full mt-8 lg:mt-10 bg-blue-600 text-white py-4 lg:py-6 rounded-[20px] lg:rounded-[30px] font-black text-xl lg:text-2xl hover:scale-105 active:scale-95 transition-all shadow-2xl">–í–û–ô–¢–ò</button>
        </div>
    </div>

    <div id="main-app" class="hidden min-h-screen">
        <header class="fixed top-0 left-0 right-0 z-50 glass-nav text-white px-4 lg:px-8 py-3 lg:py-5">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <div class="flex items-center gap-3 lg:gap-4">
                    <div class="w-10 h-10 lg:w-14 lg:h-14 bg-white text-blue-700 rounded-xl lg:rounded-2xl flex items-center justify-center font-black text-lg lg:text-2xl shadow-xl">–ê</div>
                    <div>
                        <p id="display-name" class="font-black text-base lg:text-xl leading-none truncate max-w-[150px]">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                        <p id="display-group" class="text-[10px] opacity-60 font-black uppercase tracking-widest mt-1">–ì—Ä—É–ø–ø–∞</p>
                    </div>
                </div>
                <button onclick="toggleDark()" class="w-10 h-10 lg:w-14 lg:h-14 rounded-xl lg:rounded-2xl bg-white/10 hover:bg-white/20 transition flex items-center justify-center text-xl lg:text-2xl">
                    <i id="theme-icon" class="fas fa-moon"></i>
                </button>
            </div>
        </header>

        <main class="pt-24 lg:pt-36 pb-10 px-4 lg:px-8 max-w-7xl mx-auto">
            <div class="flex overflow-x-auto gap-3 lg:gap-4 mb-8 lg:mb-12 pb-2 no-scrollbar">
                <button onclick="switchTab('voice')" class="tab-btn px-6 lg:px-10 py-3 lg:py-5 rounded-[15px] lg:rounded-[25px] bg-blue-600 text-white shadow-xl font-black text-xs lg:text-sm flex-shrink-0 transition-all active:scale-95">üó≥Ô∏è –ì–û–õ–û–° / –ß–ê–¢</button>
                <button onclick="switchTab('home')" class="tab-btn px-6 lg:px-10 py-3 lg:py-5 rounded-[15px] lg:rounded-[25px] bg-white dark:bg-slate-800 shadow-lg font-black text-xs lg:text-sm flex-shrink-0 dark:border-slate-700 transition-all active:scale-95 text-slate-500 dark:text-white">üè¢ –û–ë –ê–≠–ö</button>
                <button onclick="switchTab('rating')" class="tab-btn px-6 lg:px-10 py-3 lg:py-5 rounded-[15px] lg:rounded-[25px] bg-white dark:bg-slate-800 shadow-lg font-black text-xs lg:text-sm flex-shrink-0 dark:border-slate-700 transition-all active:scale-95 text-slate-500 dark:text-white">üèÜ –õ–ò–î–ï–†–´</button>
                <button onclick="switchTab('team')" class="tab-btn px-6 lg:px-10 py-3 lg:py-5 rounded-[15px] lg:rounded-[25px] bg-white dark:bg-slate-800 shadow-lg font-black text-xs lg:text-sm flex-shrink-0 dark:border-slate-700 transition-all active:scale-95 text-slate-500 dark:text-white">üë• –ö–î–ú</button>
            </div>

            <section id="tab-voice" class="tab-content active grid lg:grid-cols-2 gap-6 lg:gap-10">
                <div class="bg-white dark:bg-slate-800 p-6 lg:p-10 rounded-[30px] lg:rounded-[50px] shadow-xl border border-slate-100 dark:border-slate-700">
                    <div class="flex items-center gap-2 mb-6 lg:mb-8">
                        <span class="bg-red-500 text-white text-[10px] font-black px-2 py-1 rounded-full animate-pulse uppercase">Live</span>
                        <h3 class="font-black text-xl lg:text-3xl uppercase italic tracking-tighter">–û–ø—Ä–æ—Å –Ω–µ–¥–µ–ª–∏</h3>
                    </div>
                    <h4 id="poll-question" class="text-lg lg:text-2xl font-bold text-blue-600 dark:text-blue-400 mb-6 lg:mb-10 leading-tight italic truncate-multiline">...</h4>
                    <div id="poll-options" class="space-y-3 lg:space-y-4"></div>
                </div>

                <div class="bg-white dark:bg-slate-800 p-6 lg:p-10 rounded-[30px] lg:rounded-[50px] shadow-xl border border-slate-100 dark:border-slate-700 flex flex-col h-[500px] lg:h-[650px]">
                    <h3 class="font-black text-xl lg:text-3xl mb-6 lg:mb-8 uppercase italic"><i class="fas fa-comments mr-2 text-blue-500"></i> –ü—Ä—è–º–æ–π —ç—Ñ–∏—Ä</h3>
                    <div id="comments-list" class="flex-1 overflow-y-auto pr-2 mb-4 space-y-3 no-scrollbar">
                        <p class="text-center opacity-20 text-xs italic">–ó–∞–≥—Ä—É–∑–∫–∞ –º–Ω–µ–Ω–∏–π...</p>
                    </div>
                    <div class="relative">
                        <input type="text" id="comment-input" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å..." class="w-full p-4 lg:p-6 rounded-[20px] lg:rounded-[30px] bg-slate-100 dark:bg-slate-900 border-none outline-none focus:ring-2 ring-blue-500/30 text-base font-medium pr-14 lg:pr-20">
                        <button onclick="sendComment()" class="absolute right-2 top-2 bottom-2 bg-blue-600 text-white w-10 lg:w-14 rounded-[15px] lg:rounded-full hover:bg-blue-700 transition-all flex items-center justify-center">
                            <i class="fas fa-paper-plane text-sm lg:text-base"></i>
                        </button>
                    </div>
                </div>
            </section>

            <section id="tab-home" class="tab-content">
                <div class="bg-blue-700 p-8 lg:p-12 rounded-[30px] lg:rounded-[60px] text-white shadow-2xl relative overflow-hidden">
                    <h2 class="text-2xl lg:text-5xl font-black mb-4 lg:mb-6 italic uppercase">–ê–≠–ö: –ü—É—Ç—å –∫ —É—Å–ø–µ—Ö—É</h2>
                    <p class="text-base lg:text-xl opacity-90 leading-relaxed max-w-2xl">–ê–ª–º–∞—Ç–∏–Ω—Å–∫–∏–π –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –ö–æ–ª–ª–µ–¥–∂ ‚Äî —Ç–≤–æ—è –±–∞–∑–∞ –¥–ª—è –º–æ—â–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞. –ú—ã —Ü–µ–Ω–∏–º –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞.</p>
                </div>
            </section>

            <section id="tab-rating" class="tab-content">
                <div class="bg-white dark:bg-slate-800 p-6 lg:p-12 rounded-[30px] lg:rounded-[60px] shadow-xl max-w-3xl mx-auto" id="leaderboard"></div>
            </section>

            <section id="tab-team" class="tab-content">
                <div id="team-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-8"></div>
            </section>
        </main>
    </div>

    <script>
        const SHEET_ID = '1BEi1MzL4-2vTVGa_2yyYnVkkDcSch6GIZKeWUHRYFxY';
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbywhEqawg1SWOhr6rFFOPaEMDCZn2ZtMyjY4qYyF3VVdepwVd1zGwoy4cNFShbZfxTj/exec';
        const GIDS = { team: '0', polls: '1044546960', comments: '194206114' };

        function handleLogin() {
            const u = document.getElementById('user-name').value;
            const g = document.getElementById('user-group').value.toUpperCase();
            if(u.length > 2) {
                document.getElementById('login-sound').play();
                localStorage.setItem('aec_u', u); localStorage.setItem('aec_g', g);
                document.getElementById('auth-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('auth-screen').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');
                    document.getElementById('display-name').innerText = u;
                    document.getElementById('display-group').innerText = g;
                    initApp();
                }, 600);
            }
        }

        function initApp() {
            loadPolls(); loadComments(); loadData();
            setInterval(loadComments, 5000);
        }

        async function loadPolls() {
            const res = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GIDS.polls}&t=${Date.now()}`);
            const text = await res.text(); const json = JSON.parse(text.substring(47).slice(0, -2));
            const poll = json.table.rows.find(r => r.c[3]?.v === 'active');
            
            if(poll) {
                const v1 = poll.c[4]?.v || 0; const v2 = poll.c[5]?.v || 0;
                const total = v1 + v2 || 1;
                const p1 = Math.round((v1/total)*100); const p2 = 100 - p1;

                document.getElementById('poll-question').innerText = poll.c[0].v;
                document.getElementById('poll-options').innerHTML = `
                    <button onclick="submitVote(1)" class="w-full p-5 lg:p-8 rounded-[20px] lg:rounded-[35px] border-2 lg:border-4 border-slate-100 dark:border-slate-700 text-left font-black text-base lg:text-xl relative overflow-hidden transition-all active:scale-95">
                        <div class="poll-bar" style="width:${p1}%"></div>
                        <span class="relative z-10 flex justify-between uppercase italic">${poll.c[1].v} <span>${p1}%</span></span>
                    </button>
                    <button onclick="submitVote(2)" class="w-full p-5 lg:p-8 rounded-[20px] lg:rounded-[35px] border-2 lg:border-4 border-slate-100 dark:border-slate-700 text-left font-black text-base lg:text-xl relative overflow-hidden transition-all active:scale-95">
                        <div class="poll-bar" style="width:${p2}%"></div>
                        <span class="relative z-10 flex justify-between uppercase italic">${poll.c[2].v} <span>${p2}%</span></span>
                    </button>
                `;
            }
        }

        async function submitVote(opt) {
            const btns = document.querySelectorAll('#poll-options button');
            btns.forEach(b => { b.style.opacity = '0.5'; b.disabled = true; });
            await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ type: "vote", option: opt }) });
            setTimeout(loadPolls, 800);
        }

        async function loadComments() {
            const res = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GIDS.comments}&t=${Date.now()}`);
            const text = await res.text(); const json = JSON.parse(text.substring(47).slice(0, -2));
            const html = json.table.rows.slice(1).reverse().map(r => `
                <div class="bg-slate-50 dark:bg-slate-900/60 p-4 lg:p-6 rounded-[20px] lg:rounded-[30px] border border-slate-100 dark:border-slate-800 shadow-sm animate-fadeIn">
                    <div class="flex justify-between items-center mb-1">
                        <span class="font-black text-[10px] lg:text-xs text-blue-600 uppercase tracking-tighter">${r.c[1]?.v || '–°—Ç—É–¥–µ–Ω—Ç'}</span>
                        <span class="text-[9px] font-bold opacity-30">${r.c[2]?.v || ''}</span>
                    </div>
                    <p class="text-sm lg:text-base font-medium leading-snug">${r.c[3]?.v || ''}</p>
                </div>`).join('');
            document.getElementById('comments-list').innerHTML = html || '<p class="text-center opacity-20 text-xs italic">–ü–æ–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç...</p>';
        }

        async function sendComment() {
            const input = document.getElementById('comment-input');
            const btn = document.querySelector('[onclick="sendComment()"]');
            if(!input.value.trim() || btn.disabled) return;
            
            const msg = input.value; input.value = '';
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>'; btn.disabled = true;
            
            await fetch(SCRIPT_URL, { 
                method: 'POST', mode: 'no-cors',
                body: JSON.stringify({ type: "comment", name: localStorage.getItem('aec_u'), group: localStorage.getItem('aec_g'), text: msg }) 
            });
            
            btn.innerHTML = '<i class="fas fa-paper-plane"></i>'; btn.disabled = false;
            loadComments();
        }

        async function loadData() {
            const res = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GIDS.team}`);
            const text = await res.text(); const json = JSON.parse(text.substring(47).slice(0, -2));
            const rows = json.table.rows;

            document.getElementById('team-list').innerHTML = rows.slice(1).map(r => r.c[0]?.v ? `
                <div class="bg-white dark:bg-slate-800 p-6 lg:p-8 rounded-[30px] lg:rounded-[40px] shadow-md border border-slate-100 dark:border-slate-700">
                    <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 rounded-2xl flex items-center justify-center font-black text-xl mb-4 shadow-inner">${r.c[0].v.charAt(0)}</div>
                    <h3 class="font-black text-xl mb-1">${r.c[0].v}</h3>
                    <p class="text-[10px] font-black text-blue-500 uppercase mb-4 tracking-widest">${r.c[1]?.v || ''}</p>
                    <p class="opacity-50 text-xs italic leading-relaxed">"${r.c[2]?.v || '–ö–î–ú ‚Äî —Å–∏–ª–∞!'}"</p>
                </div>` : '').join('');

            const sorted = rows.slice(1).filter(r => r.c[4]?.v).map(r => ({n: r.c[4].v, s: r.c[5]?.v || 0})).sort((a,b)=>b.s - a.s);
            document.getElementById('leaderboard').innerHTML = `
                <h2 class="text-center font-black text-xl lg:text-2xl mb-6 lg:mb-10 uppercase italic">–¢–æ–ø –ê–∫—Ç–∏–≤–∏—Å—Ç–æ–≤</h2>
                <div class="space-y-3">${sorted.map((p, i) => `
                <div class="flex justify-between items-center p-4 lg:p-5 rounded-[20px] lg:rounded-[30px] ${i==0 ? 'bg-amber-50 dark:bg-amber-900/20 border-2 border-amber-200' : 'bg-slate-50 dark:bg-slate-900/40'}">
                    <div class="flex items-center gap-3 lg:gap-4">
                        <span class="w-8 h-8 flex items-center justify-center font-black ${i==0?'text-amber-500 text-xl':'opacity-20 text-lg'}">${i==0?'<i class="fas fa-crown"></i>':i+1}</span>
                        <span class="font-black text-sm lg:text-base">${p.n}</span>
                    </div>
                    <span class="bg-blue-600 text-white px-4 py-1.5 rounded-xl font-black text-[10px] uppercase">${p.s} –ë</span>
                </div>`).join('')}</div>`;
        }

        function toggleDark() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('theme-icon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('aec_theme', isDark ? 'dark' : 'light');
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('bg-blue-600', 'text-white', 'shadow-xl');
                b.classList.add('bg-white', 'dark:bg-slate-800', 'text-slate-500', 'dark:text-white');
            });
            
            const activeBtn = document.querySelector(`[onclick="switchTab('${id}')"]`);
            activeBtn.classList.remove('bg-white', 'dark:bg-slate-800', 'text-slate-500', 'dark:text-white');
            activeBtn.classList.add('bg-blue-600', 'text-white', 'shadow-xl');
            
            document.getElementById('tab-'+id).classList.add('active');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        window.onload = () => {
            if(localStorage.getItem('aec_theme') === 'dark') toggleDark();
            const u = localStorage.getItem('aec_u'); const g = localStorage.getItem('aec_g');
            if(u) {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('display-name').innerText = u;
                document.getElementById('display-group').innerText = g;
                initApp();
                switchTab('voice');
            }
        }
    </script>
</body>
</html>
